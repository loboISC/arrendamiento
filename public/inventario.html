<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Inventario - Andamios Torres</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="theme-dark.css">
    <link rel="stylesheet" href="styles/inventario-new.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Función para actualizar la información del usuario
        function updateUserInfo(user) {
            if (user) {
                document.querySelector('.user-name').textContent = user.nombre || 'Usuario';
                document.querySelector('.user-role').textContent = user.rol || 'Rol no especificado';
                if (user.imagen) {
                    document.querySelector('.avatar').src = user.imagen;
                }
            }
        }

        // Escuchar el evento de usuario cargado
        document.addEventListener('userLoaded', function (e) {
            updateUserInfo(e.detail);
        });
    </script>
    <script src="theme.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/charts-config.js" defer></script>
    <script src="js/inventory-ui.js" defer></script>
    <script src="scripts/inventario.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const exportSelect = document.getElementById('exportar-select');
            exportSelect.addEventListener('change', function () {
                if (this.value === 'pdf') {
                    // Abrir la ventana de reporte de inventario
                    window.open('reporte_inventario.html', 'ReporteInventarioPDF', 'width=1200,height=800');
                    // Resetear el selector
                    this.selectedIndex = 0;
                }
            });
        });
    </script>
</head>

<body class="app">
    <header class="main-header">
        <div class="container">
            <div class="header-content-buttons">
                <div class="header-content">
                    <h1><strong>Gestion de Inventario - Andamios Torres</strong></h1>
                    <p>Administra el inventario especializado de sistemas de andamiaje</p>
                </div>
                <div class="user-section">
                    <div class="actions">
                        <a href="principal.html" class="btn">Volver al Sistema</a>
                        <button class="btn primary" id="newProductBtn">+ Nuevo Producto</button>
                    </div>
                    <div class="user-info" id="userInfo">
                        <img src="img/default-user.png" alt="Usuario" class="avatar">
                        <div class="user-details">
                            <span class="user-name">Usuario</span>
                            <span class="user-role">Rol no especificado</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav class="main-nav">
        <div class="nav-container">
            <a href="#" class="nav-item" data-page="dashboard">
                <i class="fas fa-chart-bar"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item active" data-page="productos">
                <i class="fas fa-boxes"></i>
                <span>Productos</span>
            </a>
            <a href="#" class="nav-item" data-page="categorias">
                <i class="fas fa-tag"></i>
                <span>Categorías</span>
            </a>
            <a href="#" class="nav-item" data-page="mantenimiento">
                <i class="fas fa-tools"></i>
                <span>Mantenimiento</span>
            </a>
            <a href="#" class="nav-item" data-page="alertas">
                <i class="fas fa-bell"></i>
                <span>Alertas</span>
            </a>
        </div>
    </nav>

    <!-- Sistema de alertas -->
    <div class="alerts-container" id="alertsContainer"></div>

    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Buscar en inventario..." class="search-input">
                </div>

                <div class="topbar-actions">
                    <button class="btn-icon" title="Filtros">
                        <i class="fas fa-filter"></i>
                    </button>
                    <button class="btn-icon" title="Exportar">
                        <i class="fas fa-file-export"></i>
                    </button>
                </div>
            </header>

            <!-- Dashboard Cards -->
            <section class="dashboard-cards">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e3f2fd;">
                        <i class="fas fa-boxes" style="color: #1976d2;"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Total Productos</h3>
                        <p class="stat-value">6</p>
                        <span class="stat-change">Productos en generales</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #e8f5e9;">
                        <i class="fas fa-box-open" style="color: #2e7d32;"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Stock Total</h3>
                        <p class="stat-value">630</p>
                        <span class="stat-change">Unidades en inventario</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #fff3e0;">
                        <i class="fas fa-dolly" style="color: #e65100;"></i>
                    </div>
                    <div class="stat-info">
                        <h3>En Renta</h3>
                        <p class="stat-value">163</p>
                        <span class="stat-change">Unidades rentadas</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: #fce4ec;">
                        <i class="fas fa-exclamation-triangle" style="color: #c2185b;"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Alertas</h3>
                        <p class="stat-value">$55.9M</p>
                        <span class="stat-change">Valor total del inventario</span>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Distribución por Categoría</h3>
                        <div class="chart-actions">
                            <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                        </div>
                    </div>
                    <canvas id="categoryChart"></canvas>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Estado del Inventario</h3>
                        <div class="chart-actions">
                            <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                        </div>
                    </div>
                    <canvas id="statusChart"></canvas>
                </div>
            </section>

            <!-- Gráficas de Análisis -->
            <section class="analytics-section">
                <div class="analytics-grid">
                    <!-- Gráfica de Productos Más Rentados -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Productos Más Rentados</h3>
                            <div class="chart-actions">
                                <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                            </div>
                        </div>
                        <canvas id="topRentedChart"></canvas>
                    </div>

                    <!-- Gráfica de Tendencias de Ventas -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Tendencias de Ventas</h3>
                            <div class="chart-actions">
                                <select id="salesPeriodFilter" class="period-filter">
                                    <option value="weekly">Semanal</option>
                                    <option value="monthly">Mensual</option>
                                    <option value="quarterly">Trimestral</option>
                                    <option value="yearly" selected>Anual</option>
                                </select>
                                <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                            </div>
                        </div>
                        <canvas id="salesTrendsChart"></canvas>
                    </div>
                </div>
            </section>

        </section>

        <!-- Productos Section -->
        <section id="productos-section" class="content-section active">
            <header class="topbar">
                <div class="topbar-actions filters-row">
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="filterSearch" placeholder="Buscar por nombre, SKU o marca..."
                            class="search-input">
                    </div>
                    <select id="filterCategory" class="filter-select">
                        <option value="">Todas las categorías</option>
                        <option value="Andamio Marco y Cruceta">Andamio Marco y Cruceta</option>
                        <option value="Multidireccional">Multidireccional</option>
                        <option value="Accesorios">Accesorios</option>
                    </select>
                    <select id="filterSubcategory" class="filter-select" style="display: none;">
                        <option value="">Todas las subcategorías</option>
                    </select>
                    <select id="filterCondition" class="filter-select">
                        <option value="">Todas las condiciones</option>
                        <option value="nuevo">Nuevo</option>
                        <option value="bueno">Bueno</option>
                        <option value="regular">Regular</option>
                    </select>
                    <select id="exportar-select" class="exportar-select">
                        <option value="" disabled selected>Exportar</option>
                        <option value="pdf">Exportar a PDF</option>
                        <option value="excel">Exportar a Excel</option>
                        <option value="sql">Exportar a SQL</option>
                    </select>
                    <select name="filter-alamcen" id="filterAlmacen" class="filter-select">
                        <option value="">Todos los almacenes</option>
                        <option value="almacen-1">BODEGA 68 CDMX</option>
                        <option value="almacen-2">MEXICALI</option>
                        <option value="almacen-3">TEXCOCO</option>
                    </select>
                </div>
            </header>

            <div class="productos-grid" id="inventario-lista-productos">
                <!-- Productos se cargarán dinámicamente -->
            </div>
        </section>

        <!-- Categorías Section -->
        <section id="categorias-section" class="content-section">
            <div class="section-header">
                <h2>Gestión de Categorías</h2>
                <p class="section-subtitle">Categorías y subcategorías especializadas para andamios</p>
            </div>

            <div class="categorias-grid">
                <!-- Categorías se cargarán dinámicamente -->
            </div>
        </section>


        <!-- Mantenimiento Section -->
        <section id="mantenimiento-section" class="content-section">
            <div class="section-header">
                <h2>Control de Mantenimiento</h2>
                <p class="section-subtitle">Gestión de mantenimiento preventivo y correctivo</p>
            </div>

            <div class="mantenimiento-table">
                <!-- Tabla de mantenimiento se cargará dinámicamente -->
            </div>
        </section>

        <!-- Alertas Section -->
        <section id="alertas-section" class="content-section">
            <div class="section-header">
                <h2>Centro de Alertas</h2>
                <p class="section-subtitle">Notificaciones y alertas del sistema</p>
            </div>

            <div class="alertas-grid">
                <!-- Alertas se cargarán dinámicamente -->
            </div>
        </section>
    </main>

    <!-- Modal Nuevo Producto -->
    <div class="modal" id="newProductModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nuevo Producto</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="newProductForm">
                <!-- Información Básica -->
                <div class="form-section">
                    <h3>Información Básica</h3>
                    <p class="section-subtitle">Datos principales del producto de andamio</p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productSKU">clave*</label>
                            <input type="text" id="productSKU" name="productSKU" placeholder="Ej: AND-MAR-001" required>
                        </div>


                        <div class="form-group">
                            <label for="productBarcode">Código de Barras</label>
                            <input type="text" id="productBarcode" name="productBarcode" placeholder="Código de barras">
                        </div>
                        <div class="form-group">
                            <label for="productName">Nombre del Producto *</label>
                            <input type="text" id="productName" name="productName"
                                placeholder="Ej: Marco de Andamio 2.00" required>
                        </div>


                        <div class="form-group full-width">
                            <label for="productDescription">Descripción</label>
                            <textarea id="productDescription" name="productDescription" rows="3"
                                placeholder="Descripción detallada del producto..."></textarea>
                        </div>


                        <div class="form-group">
                            <label for="productBrand">Marca</label>
                            <input type="text" id="productBrand" name="productBrand" placeholder="Ej: ProScaffold">
                        </div>


                        <div class="form-group">
                            <label for="productModel">LOTE</label>
                            <input type="text" id="productModel" name="productModel" placeholder="Ej: PS-MAR-201">
                        </div>


                        <div class="form-group">
                            <label for="productMaterial">Material</label>
                            <input type="text" id="productMaterial" name="productMaterial"
                                placeholder="Ej: Acero galvanizado">
                        </div>


                        <div class="form-group">
                            <label for="productWarehouse">Almacén *</label>
                            <select id="productWarehouse" name="productWarehouse" required>
                                <option value="">Seleccionar almacén</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Categorización -->
                <div class="form-section">
                    <h3>Categorización</h3>
                    <p class="section-subtitle">Clasificación del producto</p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productCategory">Categoría *</label>
                            <select id="productCategory" name="productCategory" required>
                                <option value="">Seleccionar categoría</option>
                            </select>
                        </div>

                        <div class="form-group" id="subcategoryGroup" style="display: none;">
                            <!-- Inicialmente oculto -->
                            <label for="productSubcategory">Subcategoría</label>
                            <select id="productSubcategory" name="productSubcategory">
                                <option value="">Seleccionar subcategoría</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Especificaciones Técnicas -->
                <div class="form-section">
                    <h3>Especificaciones Técnicas</h3>
                    <p class="section-subtitle">Características técnicas del producto</p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productWeight">Peso (kg)</label>
                            <input type="number" id="productWeight" name="productWeight" step="0.0001" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="productCapacity">Capacidad de Carga (kg)</label>
                            <input type="number" id="productCapacity" name="productCapacity" step="0.1" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="productLength">Largo (m)</label>
                            <input type="number" id="productLength" name="productLength" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="productWidth">Ancho (m)</label>
                            <input type="number" id="productWidth" name="productWidth" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="productHeight">Alto (m)</label>
                            <input type="number" id="productHeight" name="productHeight" step="0.01" placeholder="0">
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4>Especificaciones Adicionales</h4>
                        <div class="dynamic-fields" id="additionalSpecs">
                            <div class="spec-row">
                                <input type="text" placeholder="Nombre de la especificación" name="specName[]">
                                <input type="text" placeholder="Valor" name="specValue[]">
                                <button type="button" class="btn-add-spec">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-subsection">
                        <h4>Certificaciones</h4>
                        <div class="dynamic-fields" id="certifications">
                            <div class="cert-row">
                                <input type="text" placeholder="Ej: EN-12811, CE, ISO-9001" name="certification[]">
                                <button type="button" class="btn-add-cert">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Precios -->
                <div class="form-section">
                    <h3>Precios</h3>
                    <p class="section-subtitle">Precios de venta y renta</p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="salePrice">Precio de Venta ($)</label>
                            <input type="number" id="salePrice" name="salePrice" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="dailyRent">Renta Diaria ($)</label>
                            <input type="number" id="dailyRent" name="dailyRent" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="weeklyRent">Renta Semanal ($)</label>
                            <input type="number" id="weeklyRent" name="weeklyRent" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="monthlyRent">Renta Mensual ($)</label>
                            <input type="number" id="monthlyRent" name="monthlyRent" step="0.01" placeholder="0">
                        </div>


                        <div class="form-group">
                            <label for="annualRent">Renta Anual ($)</label>
                            <input type="number" id="annualRent" name="annualRent" step="0.01" placeholder="0">
                        </div>
                    </div>
                </div>

                <!-- Control de Inventario -->
                <div class="form-section">
                    <h3>Control de Inventario</h3>
                    <p class="section-subtitle">Cantidades en stock</p>

                    <div class="inventory-table">
                        <div class="inventory-header">
                            <div class="header-cell">Stock Total</div>
                            <div class="header-cell">En Venta</div>
                            <div class="header-cell">En Renta</div>
                            <div class="header-cell">Reservado</div>
                            <div class="header-cell">Mantenimiento</div>
                        </div>
                        <div class="inventory-row">
                            <div class="inventory-cell">
                                <input type="number" id="stockTotal" name="stockTotal" value="0"
                                    class="inventory-input">
                            </div>
                            <div class="inventory-cell">
                                <input type="number" id="stockVenta" name="stockVenta" value="0"
                                    class="inventory-input">
                            </div>
                            <div class="inventory-cell">
                                <input type="number" id="stockEnRenta" name="stockEnRenta" value="0"
                                    class="inventory-input">
                            </div>
                            <div class="inventory-cell">
                                <input type="number" id="stockReservado" name="stockReservado" value="0"
                                    class="inventory-input">
                            </div>
                            <div class="inventory-cell">
                                <input type="number" id="stockMantenimiento" name="stockMantenimiento" value="0"
                                    class="inventory-input">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado del Producto -->
                <div class="form-section">
                    <h3>Estado del Producto</h3>
                    <p class="section-subtitle">Estado actual y condición</p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="productStatus">Estado</label>
                            <select id="productStatus" name="productStatus">
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                                <option value="descontinuado">Descontinuado</option>
                            </select>
                        </div>


                        <div class="form-group">
                            <label for="productCondition">Condición</label>
                            <select id="productCondition" name="productCondition">
                                <option value="nuevo">Nuevo</option>
                                <option value="usado">Usado</option>
                                <option value="refurbished">Refurbished</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Imágenes del Producto -->
                <div class="form-section">
                    <h3>Imágenes del Producto</h3>
                    <p class="section-subtitle">Subir imagen desde el ordenador</p>

                    <div class="form-group">
                        <label for="productImage">Imagen del Producto</label>
                        <div class="image-upload">
                            <input type="file" id="productImage" name="productImage" accept="image/*">
                            <div class="image-preview" id="productImagePreview">
                                <i class="fas fa-image"></i>
                                <span>Seleccionar imagen</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Agregar Componentes -->
    <div class="modal" id="modal-componentes">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Componentes</h2>
                <button class="modal-close" onclick="closeModal('modal-componentes')">&times;</button>
            </div>
            <form class="modal-form" id="componentesForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="componentName">Nombre del Componente *</label>
                        <input type="text" id="componentName" name="componentName" required>
                    </div>

                    <div class="form-group">
                        <label for="componentCode">Código *</label>
                        <input type="text" id="componentCode" name="componentCode" required>
                    </div>

                    <div class="form-group">
                        <label for="componentType">Tipo de Componente *</label>
                        <select id="componentType" name="componentType" required>
                            <option value="">Seleccionar tipo</option>
                            <option value="marco">Marco</option>
                            <option value="cruceta">Cruceta</option>
                            <option value="diagonal">Diagonal</option>
                            <option value="plataforma">Plataforma</option>
                            <option value="barandal">Barandal</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="componentMaterial">Material *</label>
                        <select id="componentMaterial" name="componentMaterial" required>
                            <option value="">Seleccionar material</option>
                            <option value="acero">Acero</option>
                            <option value="aluminio">Aluminio</option>
                            <option value="madera">Madera</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="componentDimensions">Dimensiones</label>
                        <input type="text" id="componentDimensions" name="componentDimensions"
                            placeholder="ej: 2.00 x 1.20m">
                    </div>

                    <div class="form-group">
                        <label for="componentWeight">Peso (kg)</label>
                        <input type="number" id="componentWeight" name="componentWeight" min="0" step="0.1">
                    </div>

                    <div class="form-group full-width">
                        <label for="componentDescription">Descripción</label>
                        <textarea id="componentDescription" name="componentDescription" rows="3"></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="componentImage">Imagen del Componente</label>
                        <div class="image-upload">
                            <input type="file" id="componentImage" name="componentImage" accept="image/*">
                            <div class="image-preview" id="componentImagePreview">
                                <i class="fas fa-image"></i>
                                <span>Seleccionar imagen</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary"
                        onclick="closeModal('modal-componentes')">Cancelar</button>
                    <button type="submit" class="btn-primary">Agregar Componente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Agregar Accesorios -->
    <div class="modal" id="modal-accesorios">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Accesorios</h2>
                <button class="modal-close" onclick="closeModal('modal-accesorios')">&times;</button>
            </div>
            <form class="modal-form" id="accesoriosForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="accessoryName">Nombre del Accesorio *</label>
                        <input type="text" id="accessoryName" name="accessoryName" required>
                    </div>

                    <div class="form-group">
                        <label for="accessoryCode">Código *</label>
                        <input type="text" id="accessoryCode" name="accessoryCode" required>
                    </div>

                    <div class="form-group">
                        <label for="accessoryType">Tipo de Accesorio *</label>
                        <select id="accessoryType" name="accessoryType" required>
                            <option value="">Seleccionar tipo</option>
                            <option value="rueda">Rueda</option>
                            <option value="escalera">Escalera</option>
                            <option value="plataforma">Plataforma</option>
                            <option value="conector">Conector</option>
                            <option value="abrazadera">Abrazadera</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="accessoryCompatibility">Compatibilidad *</label>
                        <select id="accessoryCompatibility" name="accessoryCompatibility" required>
                            <option value="">Seleccionar compatibilidad</option>
                            <option value="marco-cruceta">Marco y Cruceta</option>
                            <option value="multidireccional">Multidireccional</option>
                            <option value="universal">Universal</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="accessoryDimensions">Dimensiones</label>
                        <input type="text" id="accessoryDimensions" name="accessoryDimensions" placeholder="ej: 150mm">
                    </div>

                    <div class="form-group">
                        <label for="accessoryWeight">Peso (kg)</label>
                        <input type="number" id="accessoryWeight" name="accessoryWeight" min="0" step="0.1">
                    </div>

                    <div class="form-group full-width">
                        <label for="accessoryDescription">Descripción</label>
                        <textarea id="accessoryDescription" name="accessoryDescription" rows="3"></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="accessoryImage">Imagen del Accesorio</label>
                        <div class="image-upload">
                            <input type="file" id="accessoryImage" name="accessoryImage" accept="image/*">
                            <div class="image-preview" id="accessoryImagePreview">
                                <i class="fas fa-image"></i>
                                <span>Seleccionar imagen</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary"
                        onclick="closeModal('modal-accesorios')">Cancelar</button>
                    <button type="submit" class="btn-primary">Agregar Accesorio</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Los scripts ya están incluidos en el head -->
</body>

</html>