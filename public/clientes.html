<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestión de Clientes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="theme-dark.css" />
  <link rel="stylesheet" href="styles/clientes.css" />
  <link rel="stylesheet" href="styles/clientes-validations.css" />
  <link rel="stylesheet" href="modal-styles.css" />
  <script src="theme.js" defer></script>
  <script src="js/auth.js" defer></script>
  <script src="js/clientes.js" defer></script>
  <script src="js/clientes-ui.js"></script>
  <script src="js/clientes-modals.js"></script>
  <script src="js/satisfaccion.js" defer></script>
  <script src="js/transacciones.js"></script>
  <script src="js/modal-handler.js" defer></script>
</head>
<body>

  <main class="main-content">
    <div class="topbar">
      <input class="searchbar" id="search-input" placeholder="Buscar por nombre, empresa o email..." />
      <div class="topbar-right">
        <span id="notif-bell" style="position:relative;cursor:pointer"><i class="fa fa-bell"></i><span class="notif-dot"></span></span>
        <div id="notif-dropdown" style="display:none;position:absolute;right:0;top:40px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);min-width:320px;z-index:200">
          <div id="notif-list"></div>
        </div>

        <div id="user-menu" style="position:relative;margin-left:18px;">
          <img id="avatar-img" src="img/default-user.png" alt="avatar" style="width:38px;height:38px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid #e3f0ff;">
          <div id="user-dropdown" style="display:none;position:absolute;right:0;top:48px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);padding:12px;z-index:200">
            <div id="user-name" style="font-weight:600"></div>
            <div id="user-role" style="font-size:0.9rem;color:#666"></div>
            <hr style="margin:8px 0" />
            <a id="logout-btn" href="#">Cerrar sesión</a>
          </div>
        </div>
      </div>
    </div>

    <section class="header-row">
      <div>
        <h1 class="header-title">Gestión de Clientes</h1>
        <div class="header-desc">Administra clientes, historiales y satisfacción</div>
      </div>
      <div class="header-actions">
        <button class="export-btn" hrfe="dashboard.html" >
          <a href="dashboard.html">
          Volver al Sistema
        </button></a>
        <button class="add-btn">+ Nuevo Cliente</button>
      </div>
    </section>

    <nav class="tabs">
      <button class="tab active" data-section="dashboard">
        <i class="fa fa-chart-line"></i> Dashboard
      </button>
      <button class="tab" data-section="clientes">
        <i class="fa fa-users"></i> Clientes
      </button>
      <button class="tab" data-section="transacciones">
        <i class="fa fa-list"></i> Transacciones
      </button>
      <button class="tab" data-section="satisfaccion">
        <i class="fa fa-star"></i> Satisfacción
      </button>
    </nav>

    <!-- Contenedor de secciones con transición -->
    <div class="sections-container">
      <!-- Dashboard Section -->
      <section id="dashboard-area" class="active">
        <div class="summary-cards">
      <div class="summary-card">
        <div class="icon"><i class="fa fa-users"></i></div>
        <div class="info"><div class="label">Total Clientes</div><div class="value">0</div></div>
      </div>
      <div class="summary-card">
        <div class="icon green"><i class="fa fa-user-check"></i></div>
        <div class="info"><div class="label">Clientes Activos</div><div class="value">0</div></div>
      </div>
      <div class="summary-card">
        <div class="icon yellow"><i class="fa fa-star"></i></div>
        <div class="info"><div class="label">Calificación Promedio</div><div class="value">0.0</div></div>
      </div>
      <div class="summary-card">
        <div class="icon purple"><i class="fa fa-dollar-sign"></i></div>
        <div class="info"><div class="label">Ingresos Totales</div><div class="value">$0</div></div>
      </div>
    </div>

        <!-- Dashboard Charts -->
        <div class="charts-grid">
          <div class="chart-card">
            <h3>Distribución de Clientes</h3>
            <canvas id="clientesDistribucionChart"></canvas>
          </div>
          <div class="chart-card">
            <h3>clientes por ciudad</h3>
            <canvas id="ingresosMensualesChart"></canvas>
          </div>
          <div class="chart-card wide">
            <h3>Actividad de Clientes</h3>
            <canvas id="actividadClientesChart"></canvas>
          </div>
          <div class="chart-card">
            <h3>Satisfacción del cliente</h3>
            <canvas id="satisfaccionChart"></canvas>
          </div>
          <div class="chart-card">
            <h3>Servicios mas contratados</h3>
            <canvas id="serviciosChart"></canvas>
          </div>
        </div>
      </section>

      <!-- Clientes Section -->
      <section id="clientes-area">
      <!-- Aquí `js/clientes.js` renderiza las tarjetas/listado -->
      <div id="clientes-list"></div>
    </section>

    <section id="transacciones-area" style="margin-top:28px;">
      <div class="client-card">
        <div class="header-row">
          <div>
            <h3>Historial de Transacciones</h3>
            <p class="header-desc">Todas las transacciones de clientes</p>
          </div>
          <div class="header-actions">
            <button class="export-btn">
              <i class="fas fa-file-export"></i> Exportar
            </button>
            
          </div>
        </div>
        
        <table class="transactions-table">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Tipo</th>
              <th>Referencia</th>
              <th>Descripción</th>
              <th>Monto</th>
              <th>Estado</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody id="transacciones-table">
            <!-- El contenido de la tabla se llenará dinámicamente -->
          </tbody>
        </table>
      </div>
    </section>

    <section id="satisfaccion-area" style="margin-top:28px;">
      <div class="client-card">
        <h3>Encuestas de Satisfacción</h3>
        <div id="satisfaccion-list" style="min-height:120px;display:flex;align-items:center;justify-content:center;color:#999">Las encuestas de satisfacción se mostrarán aquí</div>
      </div>
    </section>

  </main>
</body>

<!-- Modal Nuevo Cliente -->
<div id="nuevo-cliente-modal" class="modal">
    <div class="modal-content" style="margin: auto;">
      <div class="modal-header">
        <h3>Nuevo Cliente</h3>
        <p class="modal-subtitle">Completa la información para crear un nuevo cliente</p>
      </div>

      <form id="nuevo-cliente-form" class="modal-form">
        <!-- Datos Básicos -->
        <div class="form-section">
          <h4>Datos Básicos</h4>
          <p class="section-desc">Información básica del cliente</p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="nc-numero-cliente">No. de Cliente</label>
              <input id="nc-numero-cliente" type="text" readonly />
            </div>
            <div class="form-group">
              <label for="nc-clave">Clave</label>
              <input id="nc-clave" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-notificar">
                Notificar
                <input id="nc-notificar" type="checkbox" style="margin-left: 8px;" />
              </label>
            </div>
            <div class="form-group full-width">
              <label for="nc-representante">Representante</label>
              <input id="nc-representante" type="text" />
            </div>
            <div class="form-group full-width">
              <label for="nc-nombre">Nombre *</label>
              <input id="nc-nombre" type="text" required />
            </div>
            <div class="form-group">
              <label for="nc-rfc">R.F.C.</label>
              <input id="nc-rfc" type="text" class="auto-format" maxlength="13" />
            </div>
            <div class="form-group">
              <label for="nc-curp">C.U.R.P.</label>
              <input id="nc-curp" type="text" class="auto-format" maxlength="18" />
            </div>
            <div class="form-group">
              <label for="nc-telefono">Teléfono</label>
              <input id="nc-telefono" type="tel" />
            </div>
            <div class="form-group">
              <label for="nc-celular">Celular</label>
              <input id="nc-celular" type="tel" />
            </div>
            <div class="form-group full-width">
              <label for="nc-email">eMail(s) *</label>
              <input id="nc-email" type="email" required />
            </div>
            <div class="form-group full-width">
              <label for="nc-comentario">Comentario</label>
              <textarea id="nc-comentario" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="nc-numero-precio">No. de Precio</label>
              <select id="nc-numero-precio">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nc-limite-credito">Límite Crédito</label>
              <input id="nc-limite-credito" type="number" min="0" step="0.01" />
            </div>
            <div class="form-group">
              <label for="nc-dias-credito">Días Crédito</label>
              <input id="nc-dias-credito" type="number" min="0" />
            </div>
            <div class="form-group">
              <label for="nc-grupo-entero">Grupo (Entero)</label>
              <input id="nc-grupo-entero" type="number" min="0" />
            </div>
          </div>
        </div>

        <!-- Datos de Facturación -->
        <div class="form-section">
          <h4>Datos Facturación</h4>
          <p class="section-desc">Información fiscal y de facturación</p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="nc-fact-rfc">R.F.C. *</label>
              <input id="nc-fact-rfc" type="text" class="auto-format" maxlength="13" required />
            </div>
            <div class="form-group">
              <label for="nc-fact-iucr">IUCR</label>
              <input id="nc-fact-iucr" type="text" />
            </div>
            <div class="form-group full-width">
              <label for="nc-razon-social">Razón Social *</label>
              <input id="nc-razon-social" type="text" required />
            </div>
            <div class="form-group full-width">
              <label for="nc-fact-curp">C.U.R.P.</label>
              <input id="nc-fact-curp" type="text" class="auto-format" maxlength="18" />
            </div>
            <div class="form-group">
              <label for="nc-regimen-fiscal">Régimen Fiscal *</label>
              <select id="nc-regimen-fiscal" required>
                <option value="">Seleccionar...</option>
                <option value="601">601 - General de Ley Personas Morales</option>
                <option value="603">603 - Personas Morales con Fines no Lucrativos</option>
                <option value="605">605 - Sueldos y Salarios e Ingresos Asimilados a Salarios</option>
                <option value="606">606 - Arrendamiento</option>
                <option value="607">607 - Régimen de Enajenación o Adquisición de Bienes</option>
                <option value="608">608 - Demás ingresos</option>
                <option value="610">610 - Residentes en el Extranjero sin Establecimiento Permanente en México</option>
                <option value="611">611 - Ingresos por Dividendos (socios y accionistas)</option>
                <option value="612">612 - Personas Físicas con Actividades Empresariales y Profesionales</option>
                <option value="614">614 - Ingresos por intereses</option>
                <option value="615">615 - Régimen de los ingresos por obtención de premios</option>
                <option value="616">616 - Sin obligaciones fiscales</option>
                <option value="620">620 - Sociedades Cooperativas de Producción que optan por diferir sus ingresos</option>
                <option value="621">621 - Incorporación Fiscal</option>
                <option value="622">622 - Actividades Agrícolas, Ganaderas, Silvícolas y Pesqueras</option>
                <option value="623">623 - Opcional para Grupos de Sociedades</option>
                <option value="624">624 - Coordinados</option>
                <option value="625">625 - Régimen de las Actividades Empresariales con ingresos a través de Plataformas Tecnológicas</option>
                <option value="626">626 - Régimen Simplificado de Confianza</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nc-uso-cfdi">Uso CFDI *</label>
              <select id="nc-uso-cfdi" required>
                <option value="">Seleccionar...</option>
                <option value="G01">G01 - Adquisición de mercancías</option>
                <option value="G02">G02 - Devoluciones, descuentos o bonificaciones</option>
                <option value="G03">G03 - Gastos en general</option>
                <option value="I01">I01 - Construcciones</option>
                <option value="I02">I02 - Mobilario y equipo de oficina por inversiones</option>
                <option value="I03">I03 - Equipo de transporte</option>
                <option value="I04">I04 - Equipo de computo y accesorios</option>
                <option value="I05">I05 - Dados, troqueles, moldes, matrices y herramental</option>
                <option value="I06">I06 - Comunicaciones telefónicas</option>
                <option value="I07">I07 - Comunicaciones satelitales</option>
                <option value="I08">I08 - Otra maquinaria y equipo</option>
                <option value="D01">D01 - Honorarios médicos, dentales y gastos hospitalarios</option>
                <option value="D02">D02 - Gastos médicos por incapacidad o discapacidad</option>
                <option value="D03">D03 - Gastos funerales</option>
                <option value="D04">D04 - Donativos</option>
                <option value="D05">D05 - Intereses reales efectivamente pagados por créditos hipotecarios (casa habitación)</option>
                <option value="D06">D06 - Aportaciones voluntarias al SAR</option>
                <option value="D07">D07 - Primas por seguros de gastos médicos</option>
                <option value="D08">D08 - Gastos de transportación escolar obligatoria</option>
                <option value="D09">D09 - Depósitos en cuentas para el ahorro, primas que tengan como base planes de pensiones</option>
                <option value="D10">D10 - Pagos por servicios educativos (colegiaturas)</option>
                <option value="P01">P01 - Por definir</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label for="nc-domicilio">Domicilio</label>
              <input id="nc-domicilio" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-numero-ext">No. Ext.</label>
              <input id="nc-numero-ext" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-numero-int">No. Int.</label>
              <input id="nc-numero-int" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-codigo-postal">Código Postal</label>
              <input id="nc-codigo-postal" type="text" maxlength="5" pattern="[0-9]{5}" />
            </div>
            <div class="form-group">
              <label for="nc-colonia">Colonia</label>
              <input id="nc-colonia" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-ciudad">Ciudad</label>
              <input id="nc-ciudad" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-localidad">Localidad</label>
              <input id="nc-localidad" type="text" />
            </div>
            <div class="form-group">
              <label for="nc-estado">Estado</label>
              <select id="nc-estado">
                <option value="">Seleccionar...</option>
                <option value="Aguascalientes">Aguascalientes</option>
                <option value="Baja California">Baja California</option>
                <option value="Baja California Sur">Baja California Sur</option>
                <option value="Campeche">Campeche</option>
                <option value="Chiapas">Chiapas</option>
                <option value="Chihuahua">Chihuahua</option>
                <option value="Ciudad de México">Ciudad de México</option>
                <option value="Coahuila">Coahuila</option>
                <option value="Colima">Colima</option>
                <option value="Durango">Durango</option>
                <option value="Estado de México">Estado de México</option>
                <option value="Guanajuato">Guanajuato</option>
                <option value="Guerrero">Guerrero</option>
                <option value="Hidalgo">Hidalgo</option>
                <option value="Jalisco">Jalisco</option>
                <option value="Michoacán">Michoacán</option>
                <option value="Morelos">Morelos</option>
                <option value="Nayarit">Nayarit</option>
                <option value="Nuevo León">Nuevo León</option>
                <option value="Oaxaca">Oaxaca</option>
                <option value="Puebla">Puebla</option>
                <option value="Querétaro">Querétaro</option>
                <option value="Quintana Roo">Quintana Roo</option>
                <option value="San Luis Potosí">San Luis Potosí</option>
                <option value="Sinaloa">Sinaloa</option>
                <option value="Sonora">Sonora</option>
                <option value="Tabasco">Tabasco</option>
                <option value="Tamaulipas">Tamaulipas</option>
                <option value="Tlaxcala">Tlaxcala</option>
                <option value="Veracruz">Veracruz</option>
                <option value="Yucatán">Yucatán</option>
                <option value="Zacatecas">Zacatecas</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nc-pais">País</label>
              <input id="nc-pais" type="text" value="MÉXICO" />
            </div>
            <div class="form-group full-width">
              <div class="checkbox-group">
                <label>
                  <input id="nc-aplican-retenciones" type="checkbox" />
                  Aplican Retenciones de Impuestos al Cliente
                </label>
              </div>
            </div>
            <div class="form-group full-width">
              <div class="checkbox-group">
                <label>
                  <input id="nc-desglosar-ieps" type="checkbox" />
                  Desglosar I.E.P.S al Cliente
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Clasificación del Cliente -->
        <div class="form-section">
          <h4>Clasificación del Cliente</h4>
          <p class="section-desc">Segmentación y categorización</p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="nc-segmento">Segmento</label>
              <select id="nc-segmento">
                <option value="Individual">Individual</option>
                <option value="Pequeña Empresa">Pequeña Empresa</option>
                <option value="Mediana Empresa">Mediana Empresa</option>
                <option value="Gran Empresa">Gran Empresa</option>
                <option value="Gobierno">Gobierno</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nc-estado">Estado</label>
              <select id="nc-estado">
                <option value="Activo">Activo</option>
                <option value="Inactivo">Inactivo</option>
                <option value="Lista Negra">Lista Negra</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Información Financiera -->
        <div class="form-section">
          <h4>Información Financiera</h4>
          <p class="section-desc">Configuración de crédito y términos de pago</p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="nc-limite-credito">Límite de Crédito ($)</label>
              <input id="nc-limite-credito" type="number" min="0" value="0" />
            </div>
            <div class="form-group">
              <label for="nc-deuda-actual">Deuda Actual ($)</label>
              <input id="nc-deuda-actual" type="number" min="0" value="0" />
            </div>
            <div class="form-group">
              <label for="nc-terminos-pago">Términos de Pago (días)</label>
              <input id="nc-terminos-pago" type="number" min="0" value="30" />
            </div>
            <div class="form-group">
              <label for="nc-metodo-pago">Método de Pago Preferido</label>
              <select id="nc-metodo-pago">
                <option value="Transferencia">Transferencia</option>
                <option value="Efectivo">Efectivo</option>
                <option value="Cheque">Cheque</option>
                <option value="Crédito">Crédito</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Calificación del Cliente -->
        <div class="form-section">
          <h4>Calificación del Cliente</h4>
          <p class="section-desc">Evaluación del desempeño y confiabilidad</p>
          
          <div class="form-grid ratings-grid">
            <div class="form-group">
              <label for="nc-cal-general">Calificación General (1-5)</label>
              <input id="nc-cal-general" type="number" min="1" max="5" value="5" />
            </div>
            <div class="form-group">
              <label for="nc-cal-pago">Confiabilidad de Pago (1-5)</label>
              <input id="nc-cal-pago" type="number" min="1" max="5" value="5" />
            </div>
            <div class="form-group">
              <label for="nc-cal-comunicacion">Calidad de Comunicación (1-5)</label>
              <input id="nc-cal-comunicacion" type="number" min="1" max="5" value="5" />
            </div>
            <div class="form-group">
              <label for="nc-cal-equipos">Cuidado de Equipos (1-5)</label>
              <input id="nc-cal-equipos" type="number" min="1" max="5" value="5" />
            </div>
            <div class="form-group">
              <label for="nc-cal-satisfaccion">Satisfacción General (1-5)</label>
              <input id="nc-cal-satisfaccion" type="number" min="1" max="5" value="5" />
            </div>
            <div class="form-group">
              <label for="nc-fecha-evaluacion">Fecha de Última Evaluación</label>
              <input id="nc-fecha-evaluacion" type="date" />
            </div>
          </div>

          <div class="form-group full-width">
            <label for="nc-notas-evaluacion">Notas de Evaluación</label>
            <textarea id="nc-notas-evaluacion" rows="2" placeholder="Observaciones sobre el desempeño del cliente..."></textarea>
          </div>
        </div>

        <!-- Notas Adicionales -->
        <div class="form-section">
          <h4>Notas Adicionales</h4>
          <p class="section-desc">Información adicional y observaciones</p>
          
          <div class="form-group full-width">
            <label for="nc-notas-generales">Notas Generales</label>
            <textarea id="nc-notas-generales" rows="3" placeholder="Observaciones generales, preferencias, restricciones, etc..."></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="close-nuevo-cliente-modal">Cancelar</button>
          <button type="submit" class="btn-primary" id="save-nuevo-cliente">Guardar</button>
        </div>
      </form>
    </div>
  </div>

<!-- Modal Historial Cliente -->
<div id="historial-cliente-modal" class="modal">
  <div class="modal-content historial-modal-content">
    <div class="modal-header">
      <h3>Historial del Cliente</h3>
      <p class="modal-subtitle">Información completa del historial del cliente</p>
    </div>

    <div class="historial-container">
      <!-- Información del Cliente -->
      <div class="historial-cliente-info">
        <div class="cliente-header">
          <div class="cliente-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="cliente-details">
            <h4 id="historial-cliente-nombre">Nombre del Cliente</h4>
            <p id="historial-cliente-empresa">Empresa</p>
            <div class="cliente-tags">
              <span class="tag" id="historial-cliente-tipo">Tipo</span>
              <span class="tag" id="historial-cliente-estado">Estado</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Estadísticas del Cliente -->
      <div class="historial-stats">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-file-contract"></i>
          </div>
          <div class="stat-info">
            <div class="stat-value" id="historial-total-contratos">0</div>
            <div class="stat-label">Contratos</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-calculator"></i>
          </div>
          <div class="stat-info">
            <div class="stat-value" id="historial-total-cotizaciones">0</div>
            <div class="stat-label">Cotizaciones</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-receipt"></i>
          </div>
          <div class="stat-info">
            <div class="stat-value" id="historial-total-facturas">0</div>
            <div class="stat-label">Facturas</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-info">
            <div class="stat-value" id="historial-valor-total">$0</div>
            <div class="stat-label">Valor Total</div>
          </div>
        </div>
      </div>

      <!-- Tabs de Historial -->
      <div class="historial-tabs">
        <button class="tab-btn active" data-tab="contratos">
          <i class="fas fa-file-contract"></i> Contratos
        </button>
        <button class="tab-btn" data-tab="cotizaciones">
          <i class="fas fa-calculator"></i> Cotizaciones
        </button>
        <button class="tab-btn" data-tab="facturas">
          <i class="fas fa-receipt"></i> Facturas
        </button>
        <button class="tab-btn" data-tab="pagos">
          <i class="fas fa-credit-card"></i> Pagos
        </button>
      </div>

      <!-- Contenido de las Tabs -->
      <div class="tab-content active" id="tab-contratos">
        <div class="historial-list">
          <div class="empty-state">
            <i class="fas fa-file-contract"></i>
            <h4>No hay contratos registrados</h4>
            <p>Este cliente aún no tiene contratos asociados</p>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-cotizaciones">
        <div class="historial-list">
          <div class="empty-state">
            <i class="fas fa-calculator"></i>
            <h4>No hay cotizaciones registradas</h4>
            <p>Este cliente aún no tiene cotizaciones asociadas</p>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-facturas">
        <div class="historial-list">
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <h4>No hay facturas registradas</h4>
            <p>Este cliente aún no tiene facturas asociadas</p>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tab-pagos">
        <div class="historial-list">
          <div class="empty-state">
            <i class="fas fa-credit-card"></i>
            <h4>No hay pagos registrados</h4>
            <p>Este cliente aún no tiene pagos asociados</p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-secondary" id="close-historial-modal">Cerrar</button>
    </div>
  </div>
  </div>

<!-- Modal Encuesta de Satisfacción -->
<div id="encuesta-satisfaccion-modal" class="modal">
  <div class="modal-content encuesta-modal-content">
    <div class="modal-header">
      <h3>Encuesta de Satisfacción del Cliente</h3>
      <p class="modal-subtitle">Vista previa y opciones de compartir</p>
    </div>

    <div class="encuesta-container">
      <!-- Vista Previa -->
      <div class="preview-section">
        <h4>Vista Previa de la Encuesta</h4>
        <div class="preview-frame">
          <iframe id="encuesta-preview" src="sastifaccion_clienteSG.html" width="100%" height="400" frameborder="0"></iframe>
        </div>
      </div>

      <!-- Información de la Encuesta -->
      <div class="encuesta-info">
        <div class="info-card">
          <div class="info-header">
            <i class="fas fa-link"></i>
            <h5>URL de la Encuesta</h5>
          </div>
          <div class="url-container">
            <input type="text" id="encuesta-url" readonly value="https://tu-dominio.com/sastifaccion_clienteSG.html" />
            <button class="btn-copy" onclick="copiarURL()">
              <i class="fas fa-copy"></i> Copiar
            </button>
          </div>
        </div>

        <div class="info-card">
          <div class="info-header">
            <i class="fas fa-chart-bar"></i>
            <h5>Estadísticas de la Encuesta</h5>
          </div>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="total-respuestas">0</div>
              <div class="stat-label">Respuestas</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="promedio-satisfaccion">0.0</div>
              <div class="stat-label">Promedio</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="tasa-respuesta">0%</div>
              <div class="stat-label">Tasa Respuesta</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Opciones de Compartir -->
      <div class="share-section">
        <h4>Compartir Encuesta</h4>
        <div class="share-options">
          <button class="share-btn whatsapp" onclick="compartirWhatsApp()">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp</span>
          </button>
          <button class="share-btn email" onclick="compartirEmail()">
            <i class="fas fa-envelope"></i>
            <span>Correo Electrónico</span>
          </button>
          <button class="share-btn link" onclick="copiarURL()">
            <i class="fas fa-link"></i>
            <span>Copiar Enlace</span>
          </button>
        </div>
      </div>

      <!-- Configuración de Cliente (Opcional) -->
      <div class="client-config">
        <h4>Configuración para Cliente Específico</h4>
        <div class="config-form">
          <div class="form-group">
            <label for="cliente-nombre">Nombre del Cliente:</label>
            <input type="text" id="cliente-nombre" placeholder="Nombre del cliente (opcional)" />
          </div>
          <div class="form-group">
            <label for="proyecto-relacionado">Proyecto/Contrato:</label>
            <input type="text" id="proyecto-relacionado" placeholder="Número de proyecto o contrato (opcional)" />
          </div>
          <button class="btn-generar" onclick="generarURLPersonalizada()">
            <i class="fas fa-magic"></i> Generar URL Personalizada
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-secondary" id="close-encuesta-modal">Cerrar</button>
      <button type="button" class="btn-primary" onclick="verEstadisticas()">
        <i class="fas fa-chart-line"></i> Ver Estadísticas
      </button>
    </div>
  </div>
</div>

  <script>
    (function() {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const avatarImg = document.getElementById('avatar-img');
      const avatarDropdown = document.getElementById('avatar-img-dropdown');
      const userName = document.getElementById('user-name');
      const userRole = document.getElementById('user-role');
      const userEmail = document.getElementById('user-email');
      const dropdown = document.getElementById('user-dropdown');
      if (user && avatarImg) {
        avatarImg.src = user.foto || 'img/default-user.png';
        avatarImg.onerror = () => { avatarImg.src = 'img/default-user.png'; };
      }
      if (user && avatarDropdown) {
        avatarDropdown.src = user.foto || 'img/default-user.png';
        avatarDropdown.onerror = () => { avatarDropdown.src = 'img/default-user.png'; };
      }
      if (userName) userName.textContent = user.nombre || '';
      if (userRole) userRole.textContent = user.rol || '';
      if (userEmail) userEmail.textContent = user.correo || '';
      if (avatarImg && dropdown) {
        avatarImg.onclick = function(e) {
          e.stopPropagation();
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        };
        document.body.addEventListener('click', function(e) {
          if (!e.target.closest('#user-menu')) dropdown.style.display = 'none';
        });
      }
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.onclick = function(e) {
          e.preventDefault();
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.href = 'login.html';
        };
      }
    })();
  </script>
</body>
</html>