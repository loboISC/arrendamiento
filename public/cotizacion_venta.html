<!DOCTYPE html>
<html lang="es" class="dark-theme">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nueva Cotización de Venta</title>
  <link rel="stylesheet" href="styles/bootstrap-icons.css" />
  <link rel="stylesheet" href="theme-dark.css" />
  <link rel="stylesheet" href="styles/cotizacion_venta.css" />
  <link rel="stylesheet" href="modal-styles.css" />
  <script src="theme.js" defer></script>
  <!--<script src="js/auth.js" defer></script> -->
</head>
  
<body class="dark-theme">
  <div class="container">
    <div class="page-header">
      <h1><i class="bi bi-receipt-cutoff" style="margin-right:8px"></i> Nueva Cotización de Venta</h1>
      <div class="inline">
        <a href="cotizaciones.html" class="btn">← Regresar</a>
        <button id="btnModoGuiado" class="btn">Modo Guiado</button>
      </div>
    </div>

    <div class="workflow-container card" id="ventaWizard">
      <!-- Indicador de pasos (2 al 11) -->
      <div class="step-indicator inline" style="margin-bottom:8px">
        <span class="step badge" data-step="0">2</span>
        <span class="step badge" data-step="1">3</span>
        <span class="step badge" data-step="2">4</span>
        <span class="step badge" data-step="3">5</span>
        <span class="step badge" data-step="4">6</span>
        <span class="step badge" data-step="5">7</span>
        <span class="step badge" data-step="6">8</span>
        <span class="step badge" data-step="7">9</span>
        <span class="step badge" data-step="8">10</span>
        <span class="step badge" data-step="9">11</span>
      </div>
      <div class="wizard-hint">Sigue los pasos para crear tu cotización</div>
      <div class="progress-dots" id="progressDots"></div>

      <!-- Paso 2: Productos principales (solo venta) -->
      <div class="step-content" data-step="0">
        <h3 class="section-title">Paso 2: Selección de Productos Principales</h3>
        <p class="section-sub">Elige uno o más productos para comenzar</p>
        <div class="grid">
          <div class="inline" style="gap:8px; flex-wrap:wrap">
            <input class="form-control" id="buscadorProductos" style="max-width:380px" placeholder="Buscar producto o SKU" />
            <div class="badge" id="chipTodos" style="cursor:pointer">Todos</div>
            <div class="badge" id="chipMasVendidos" style="cursor:pointer">Más vendidos</div>
            <div class="badge" id="chipNuevos" style="cursor:pointer">Nuevos</div>
            <div class="right"></div>
            <span class="badge" id="contadorSeleccion">0 seleccionados</span>
          </div>
          <div id="gridProductos" class="product-grid"></div>
        </div>
        <div class="frame">
          <h4 style="margin:0 0 10px;text-align:center">Productos Seleccionados</h4>
          <div id="resumenProductos" class="grid"></div>
        </div>
      </div>

      <!-- Paso 3: Detalles del Producto (lista y modal) -->
      <div class="step-content" data-step="1" hidden>
        <h3 class="section-title">Paso 3: Detalles del Producto</h3>
        <p class="section-sub">Configura los detalles de los productos seleccionados</p>
        <div class="frame">
          <h4 style="margin:0 0 10px">Productos Seleccionados:</h4>
          <div id="resumenProductos" class="grid"></div>
        </div>
      </div>

      <!-- Paso 4: Accesorios de complemento -->
      <div class="step-content" data-step="2" hidden>
        <h3 class="section-title">Paso 4: Accesorios de Complemento</h3>
        <p class="section-sub">Selecciona accesorios adicionales para complementar tu cotización</p>
        <div class="product-grid" id="gridAccesorios"></div>
      </div>

      <!-- Paso 5: Detalles de Accesorios -->
      <div class="step-content" data-step="3" hidden>
        <h3 class="section-title">Paso 5: Detalles de Accesorios</h3>
        <p class="section-sub">Configura los detalles de los accesorios seleccionados</p>
        <div class="frame">
          <h4 style="margin:0 0 10px">Accesorios Seleccionados:</h4>
          <div id="resumenAccesorios" class="grid"></div>
        </div>
      </div>

      <!-- Paso 6: Método de Entrega -->
      <div class="step-content" data-step="4" hidden>
        <h3 class="section-title">Paso 6: Método de Entrega</h3>
        <div class="inline" style="gap:12px">
          <label class="badge"><input type="radio" name="metodoEntrega" value="obra" checked> Entregar en Obra</label>
          <label class="badge"><input type="radio" name="metodoEntrega" value="sucursal"> Recoger en Sucursal</label>
          <div class="right"></div>
          <div class="inline"><label style="margin:0 8px 0 0">Fecha:</label><input type="date" class="form-control" style="width:auto"></div>
        </div>
      </div>

      <!-- Paso 7: Dirección de Entrega -->
      <div class="step-content" data-step="5" hidden>
        <h3 class="section-title">Paso 7: Dirección de Entrega</h3>
        <div class="form-row">
          <div class="col-6"><label>Calle</label><input class="form-control"></div>
          <div class="col-3"><label>Colonia</label><input class="form-control"></div>
          <div class="col-3"><label>Código Postal</label><input class="form-control"></div>
          <div class="col-4"><label>Ciudad</label><input class="form-control"></div>
          <div class="col-4"><label>Estado</label><input class="form-control"></div>
          <div class="col-4"><label>Referencia</label><input class="form-control"></div>
        </div>
      </div>

      <!-- Paso 8: Búsqueda de Ubicación -->
      <div class="step-content" data-step="6" hidden>
        <h3 class="section-title">Paso 8: Búsqueda de Ubicación</h3>
        <p class="section-sub">Confirma tu ubicación en el mapa</p>
        <div class="card" style="height:260px;display:flex;align-items:center;justify-content:center;opacity:.8">Mapa (próximamente)</div>
        <button class="btn" id="btnBuscarUbicacion">Buscar Ubicación</button>
      </div>

      <!-- Paso 9: Datos de Contacto -->
      <div class="step-content" data-step="7" hidden>
        <h3 class="section-title">Paso 9: Datos de Contacto</h3>
        <div class="form-row">
          <div class="col-6"><label>Nombre</label><input class="form-control"></div>
          <div class="col-3"><label>Teléfono</label><input class="form-control"></div>
          <div class="col-3"><label>Email</label><input class="form-control" type="email"></div>
          <div class="col-6"><label>Empresa</label><input class="form-control"></div>
          <div class="col-12"><label>Notas</label><textarea class="form-control" rows="3"></textarea></div>
        </div>
      </div>

      <!-- Paso 10: Resumen de Cotización -->
      <div class="step-content" data-step="8" hidden>
        <h3 class="section-title">Paso 10: Resumen de Cotización</h3>
        <div class="grid-2">
          <div class="card"><h4>Productos</h4><div id="sumProductos"></div></div>
          <div class="card"><h4>Accesorios</h4><div id="sumAccesorios"></div></div>
          <div class="card">
            <h4>Totales</h4>
            <div class="totals">
              <div class="row"><span>Subtotal</span><strong id="tSubtotal">$0.00</strong></div>
              <div class="row"><span>Envío</span><strong id="tEnvio">$0.00</strong></div>
              <div class="row"><span>IVA (16%)</span><strong id="tIva">$0.00</strong></div>
              <div class="row"><span>Total</span><strong id="tTotal">$0.00</strong></div>
            </div>
            <div class="inline" style="margin-top:12px">
              <button class="btn" id="btnDescargar">Descargar Cotización</button>
              <button class="btn" id="btnGuardar">Guardar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Paso 11: Datos de Facturación / Hoja de Pedido -->
      <div class="step-content" data-step="9" hidden>
        <h3 class="section-title">Paso 11: Datos de Facturación</h3>
        <div class="frame">
          <div class="form-row">
            <div class="col-6"><label>Uso CFDI</label><select class="form-control"><option>G01</option><option>G03</option></select></div>
            <div class="col-6"><label>Régimen Receptor</label><select class="form-control"><option>601</option><option>605</option></select></div>
            <div class="col-6"><label>Método de Pago</label><select class="form-control"><option>PUE</option><option>PPD</option></select></div>
            <div class="col-6"><label>Forma de Pago</label><select class="form-control"><option>03 Transferencia</option><option>01 Efectivo</option></select></div>
            <div class="col-12"><label>Correo</label><input class="form-control" type="email" placeholder="cliente@correo.com"></div>
          </div>
          <div class="inline" style="margin-top:12px">
            <button class="btn-primary" id="btnAbrirFacturacion">Timbrar</button>
            <button class="btn" id="btnHojaPedido">Ver Hoja de Pedido</button>
          </div>
        </div>
      </div>
        <!-- Se eliminan campos de fecha/pagos y totales para mantener el paso 2 limpio -->
      </div>
      </div>

      <!-- Paso 4: Datos de Facturación (sin contrato/pagaré) -->
      <div class="step-content" data-step="3" hidden>
        <h3>Paso 4: Datos de Facturación</h3>
        <p class="muted">Captura los datos para timbrar la factura. En venta directa no hay contrato ni pagaré.</p>
        <div class="form-row">
          <div class="col-6">
            <label>Uso CFDI</label>
            <select class="form-control">
              <option>G01 - Adquisición de mercancías</option>
              <option>G03 - Gastos en general</option>
            </select>
          </div>
          <div class="col-6">
            <label>Régimen Fiscal del Receptor</label>
            <select class="form-control">
              <option>601 - General de Ley Personas Morales</option>
              <option>605 - Sueldos y Salarios</option>
            </select>
          </div>
          <div class="col-6">
            <label>Método de Pago</label>
            <select class="form-control">
              <option>PUE</option>
              <option>PPD</option>
            </select>
          </div>
          <div class="col-6">
            <label>Forma de Pago</label>
            <select class="form-control">
              <option>03 - Transferencia electrónica</option>
              <option>01 - Efectivo</option>
              <option>28 - Tarjeta de Débito</option>
            </select>
          </div>
          <div class="col-12">
            <label>Correo para envío de factura</label>
            <input type="email" class="form-control" placeholder="cliente@dominio.com" />
          </div>
        </div>
      </div>

      <!-- Paso 5: Resumen y Confirmación -->
      <div class="step-content" data-step="4" hidden>
        <h3>Paso 5: Resumen y Confirmación</h3>
        <div class="grid">
          <div class="card">
            <h4>Resumen</h4>
            <ul>
              <li>Cliente seleccionado</li>
              <li>Productos agregados</li>
              <li>Totales calculados</li>
              <li>Datos de facturación listos</li>
            </ul>
          </div>
          <div class="inline">
            <button class="btn" id="btnGuardar">Guardar Cotización</button>
            <div class="right"></div>
            <button class="btn-primary" id="btnIrAFacturar">Ir a Facturar</button>
          </div>
        </div>
      </div>

      <!-- Navegación -->
      <div class="step-navigation inline" style="margin-top:12px">
        <button type="button" class="btn" id="prevBtn"><i class="bi bi-arrow-left"></i> Anterior</button>
        <div class="right"></div>
        <button type="button" class="btn-primary" id="nextBtn">Siguiente <i class="bi bi-arrow-right"></i></button>
      </div>
    </div>
  </div>

  <!-- Modales -->
  <!-- Detalle de Producto -->
  <div id="modalProducto" class="card" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:999;min-width:420px;display:none">
    <h3>Detalle de Producto</h3>
    <div class="form-row">
      <div class="col-6"><label>Cantidad</label><input class="form-control" id="mpCantidad" type="number" value="1"></div>
      <div class="col-6"><label>Precio</label><input class="form-control" id="mpPrecio" type="number" value="0"></div>
      <div class="col-12"><label>Notas</label><textarea class="form-control" id="mpNotas" rows="2"></textarea></div>
    </div>
    <div class="inline" style="margin-top:8px"><button class="btn" id="mpCancelar">Cancelar</button><div class="right"></div><button class="btn-primary" id="mpGuardar">Guardar</button></div>
  </div>

  <!-- Detalle de Accesorio -->
  <div id="modalAccesorio" class="card" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:999;min-width:420px;display:none">
    <h3>Detalle de Accesorio</h3>
    <div class="form-row">
      <div class="col-6"><label>Cantidad</label><input class="form-control" id="maCantidad" type="number" value="1"></div>
      <div class="col-6"><label>Precio</label><input class="form-control" id="maPrecio" type="number" value="0"></div>
    </div>
    <div class="inline" style="margin-top:8px"><button class="btn" id="maCancelar">Cancelar</button><div class="right"></div><button class="btn-primary" id="maGuardar">Guardar</button></div>
  </div>

  <!-- Facturación -->
  <div id="modalFacturacion" class="card" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:999;min-width:520px;display:none">
    <h3>Datos de Facturación</h3>
    <div class="form-row">
      <div class="col-6"><label>Uso CFDI</label><select class="form-control"><option>G01</option><option>G03</option></select></div>
      <div class="col-6"><label>Régimen Receptor</label><select class="form-control"><option>601</option><option>605</option></select></div>
      <div class="col-6"><label>Método de Pago</label><select class="form-control"><option>PUE</option><option>PPD</option></select></div>
      <div class="col-6"><label>Forma de Pago</label><select class="form-control"><option>03 Transferencia</option><option>01 Efectivo</option></select></div>
      <div class="col-12"><label>Correo</label><input class="form-control" type="email"></div>
    </div>
    <div class="inline" style="margin-top:8px"><button class="btn" id="mfCancelar">Cancelar</button><div class="right"></div><button class="btn-primary" id="mfTimbrar">Timbrar</button></div>
  </div>
  <div id="modalOverlay" style="position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:998;display:none"></div>
</body>
  <script src="scripts/cotizacion_venta.js"></script>

</body>
</html>
